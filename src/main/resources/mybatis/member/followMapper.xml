<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="FollowMapper">

	<!-- 회원을 위한 추천 팔로우(랜덤으로 5명의 회원 가져오기) -->
	<select id="getRecommendedFollowers" resultType="Member">
	    <![CDATA[
	    SELECT *
	    FROM (SELECT *
	          FROM member
	          ORDER BY DBMS_RANDOM.VALUE)
	    WHERE ROWNUM <= 5;
	    ]]>
	</select>
	
	<!-- user_id 가져오는 쿼리문 (user_nick) -> user_id -->
	<!-- 
	<select id="getUserIdByNick" resultType="int" parameterType="String">
	    SELECT user_id FROM member
	    WHERE user_nick = #{userNick};
	</select>
	 -->
	
	<!-- 내가 상대를 팔로우 하는 쿼리문 -->
	<!-- 입력 데이터 : 내userId(followerId), 상대의userId(followeeId) -->
	<insert id="followUser" parameterType="Follow">
	    INSERT INTO follow (follow_id, follower_id, created_date, followee_id)
	    VALUES (SEQ_FOLLOW.NEXTVAL, #{followerId}, SYSDATE, #{followeeId});
	</insert>
	
	<!-- 내 팔로잉(내가 등록한 사람) 수를 가져오는 쿼리문 -->
	<!-- 입력 데이터 : userId -->
	<select id="getFollowingCount" resultType="int" parameterType="int">
	    SELECT COUNT(*)
	    FROM follow
	    WHERE follower_id = #{userId};
	</select>
	
	<!-- 내 팔로워(나를 등록한 사람) 수를 가져오는 쿼리문 -->
	<!-- 입력 데이터 : userId -->
	<select id="getFollowerCount" resultType="int" parameterType="int">
	    SELECT COUNT(*)
	    FROM follow
	    WHERE followee_id = #{userId};
	</select>
	
	<!-- 내 팔로잉(내가 등록한 사람) 목록을 가져오는 쿼리문 -->
	<!-- 입력 데이터 : userId -->
	<select id="getFollowingList" resultType="Following" parameterType="int">
	    SELECT user_profile, user_nick, user_intro, user_id, MAX(follow_id) AS follow_id
	    FROM follow F RIGHT JOIN member M
	    ON M.user_id = F.followee_id
	    WHERE M.user_id IN (SELECT DISTINCT followee_id FROM follow WHERE follower_id = #{userId})
	    GROUP BY user_profile, user_nick, user_intro, user_id;
	</select>
	
	<!-- 내 팔로워(나를 등록한 사람) 목록을 가져오는 쿼리문 -->
	<!-- 입력 데이터 : userId -->
	<select id="getFollowerList" resultType="Follower" parameterType="int">
	    SELECT user_profile, user_nick, user_intro, user_id
	    FROM follow F RIGHT JOIN member M
	    ON M.user_id = F.followee_id
	    WHERE M.user_id IN (SELECT DISTINCT follower_id FROM follow WHERE followee_id = #{userId});
	</select>
	
	<!-- 팔로우 유무 확인 (0일시 안누름) -->
	<!-- 입력 데이터 : userId, 상대의 userId(followeeId) -->
	<select id="checkFollowStatus" resultType="int" parameterType="Follow">
	    SELECT COUNT(*)
	    FROM follow
	    WHERE follower_id = #{userId} AND followee_id = #{followeeId};
	</select>
	
	<!-- 내가 등록한 사람 삭제. 팔로우 취소 -->
	<!-- 입력 데이터 : followId -->
	<delete id="unfollowUser" parameterType="int">
	    DELETE FROM follow
	    WHERE follow_id = #{followId};
	</delete>

</mapper>
